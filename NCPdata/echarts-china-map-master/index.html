<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=EDGE">
  <title>2020年nCov实时数据追踪</title>
  <style>
    body {
      background-image: url(img/back-dark.jpg);
      background-size: cover;
    }

    #back {
      position: absolute;
      z-index: 1;
      display: none;
    }

    #china-map {
      width: 780px;
      height: 465px;
      margin: auto;
      /* border: 2px solid powderblue; */
      display: none;
    }

    #ChinaMapAnimate {
      width: 100%;
      height: 465px;
      margin: auto;
      /* border: 2px solid powderblue */
    }

    #ranklist {
      width: 100%;
      height: 675px;
      /* 825px */
      /* border: 2px yellowgreen solid; */
    }

    #timePie {
      width: 100%;
      height: 270px;
      /* border: 2px rgb(50, 143, 205) solid; */
    }

    #timeLine {
      width: 100%;
      height: 250px;
      /* border: 2px rgb(50, 205, 115) solid; */
    }

    #timeCalendar {
      width: 100%;
      height: 305px;
      /* border: 2px rgb(119, 0, 167) solid; */
    }

    #incri {
      width: 100%;
      height: 360px;
      /* border: 2px rgb(119, 0, 167) solid; */
    }

    #change {
      position: absolute;
      right: 20px;
      z-index: 2;
    }

    #change1 {
      padding: 10px 10px 10px 20px;
      background-color: rgb(0, 161, 224);
      color: white;
      float: left;
      border-radius: 100px 0 0 100px;
      cursor: pointer;
    }

    #change2 {
      padding: 10px 20px 10px 10px;
      background-color: rgb(116, 116, 116);
      color: white;
      float: left;
      border-radius: 0 100px 100px 0;
      cursor: pointer;

    }

    #updateDataPanel {
      height: 150px;
      width: 500px;
      /* border: 2px rgb(119, 0, 167) solid; */
      position: relative;
      left: -20px;
    }

    .numberBlock {
      width: 100px;
      height: 100px;
      border-radius: 20px;
      background-color: wheat;
      float: left;
      margin-right: 20px;
      padding: 10px;
      color: white;
    }

    #numberBlock1 {
      position: relative;
      top: 0px;
      background: linear-gradient(to bottom right, #0066ff, #00ffea);
      box-shadow: 0px 9px 15px #00ffea41;
      transition: 0.4s;
    }

    #numberBlock1:hover {
      top: -10px;
      box-shadow: 0px 9px 15px #00ffea;
    }

    #numberBlock2 {
      background: linear-gradient(to bottom right, #FA742B, #FCFF00);
      box-shadow: 0px 9px 15px rgba(251, 255, 0, 0.26);
      transition: 0.4s;
      position: relative;
      top: 0px;
    }

    #numberBlock2:hover {
      top: -10px;
      box-shadow: 0px 9px 15px #FCFF00;
    }

    #numberBlock3 {
      background: linear-gradient(to bottom right, rgb(23, 145, 54), #F0FF00);
      box-shadow: 0px 9px 15px rgba(251, 255, 0, 0.26);
      transition: 0.4s;
      position: relative;
      top: 0px;
    }

    #numberBlock3:hover {
      top: -10px;
      box-shadow: 0px 9px 15px #FCFF00;
    }

    #numberBlock4 {
      background: linear-gradient(to bottom right, #1b1b1b, #6d6d6d);
      box-shadow: 0px 9px 15px #6d6d6d59;
      transition: 0.4s;
      position: relative;
      top: 0px;
    }

    #numberBlock4:hover {
      top: -10px;
      box-shadow: 0px 9px 15px #6d6d6d;
    }

    #show {
      position: absolute;
      width: 400px;
      height: 760px;
      background-color: white;
      border-radius: 50px;
      margin: auto;
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 10;
      overflow: hidden;
      box-shadow: 0px 4px 20px #333333;
      display: none;
    }

    #OutShow {
      background-color: rgb(116, 116, 116);
      color: white;
      font-size: 30px;
      font-weight: bold;
      width: 50px;
      height: 50px;
      border-radius: 100%;
      margin: 0 auto;
      transition: 0.4s;
      cursor: pointer;
      margin-top: 30px;
    }

    #OutShow:hover {
      background-color: tomato;
    }

    #author {
      color: white;
      position: absolute;

      width: 100px;
      height: 30px;
      z-index: 10;
      text-align: center;
      padding: 3px;
      transition: 0.4s;
      border-radius: 50px;
      right: 0;
      cursor: pointer;
    }

    #author:hover {
      color: white;
      background: linear-gradient(to bottom right, #0059ff, #00ffc8);

    }

    #news {
      color: white;
      position: absolute;
      top: 40px;
      width: 100px;
      height: 30px;
      z-index: 10;
      text-align: center;
      padding: 3px;
      transition: all 0.4s;
      border-radius: 50px;
      right: 0;
      cursor: pointer;
    }

    #news:hover {
      color: white;
      background: linear-gradient(to bottom right, #0059ff, #00ffc8);

    }
    #loadingALL{
      width: 100%;
      height: 100%;
      background-color: rgba(255, 255, 255, 0.692);
      position: absolute;
      z-index: 20;
      font-size: 40px;
    }
  </style>
  <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
  <script type="text/javascript" src="js/jquery.min.js"></script>
  <script type="text/javascript" src="js/bootstrap.min.js"></script>

  <script type="text/javascript" src="./js/echarts.min.js"></script>
  <script type="text/javascript" src="./js/chalk.js"></script>
  <script type="text/javascript" src="./js/map/china.js"></script>
</head>

<body>
  <div id="loadingALL" class="text-center">
    <img src="img/load.gif" style="margin: 0 auto; border-radius: 50px;width:600px"><br>
    正在加载最新数据...<br>大约需要20s</div>
  <div id="author">
    作者
  </div>
  <div id="news">
    更多新闻
  </div>
  <div id="show" class="text-center">
    <img src="img/showBack.jpg" width="400px">

    <h3><br>Author</h3>
    <p><a href="https://github.com/Darius18">z.chi</a></p>
    <h3>Special Thanks</h3>
    <p>张重生老师<br>栗哲远<br>刘子涵<br>吕建彩</p>
    <p>项目地址：<a
        href="https://github.com/Darius18/nCov-Data-visualization-web">https://github.com/Darius18/nCov-Data-visualization-web</a>
    </p>

    <h5><br>祝您平安，中国加油。</h5>
    <div id="OutShow">×</div>

  </div>

  <div class="container-fluid">
    <div class="row clearfix" style="margin-bottom: 20px;margin-top: 10px;">
      <div class="col-md-12 column text-center">
        <h4 style="color: white;">2020年nCov实时数据追踪 </h4>
        <p id="updateTime" style="color: white;">最近更新时间：</p>
      </div>
    </div>
    <div class="row clearfix">
      <div class="col-md-5 column">
        <div class="row clearfix">
          <div class="col-md-12 column">
            <!-- 地图 -->
            <button id="back">返回全国</button>
            <div id="change">
              <div id="change1" class="text-center">时空演变</div>
              <div id="change2" class="text-center">地图下钻</div>

            </div>
            <div id="china-map"></div>
            <div id="ChinaMapAnimate"></div>
          </div>
        </div>
        <div class="row clearfix">
          <div class="col-md-12 column">
            <!-- 增长 -->
            <div id="incri"></div>
          </div>
        </div>
      </div>
      <div class="col-md-3 column">
        <div class="row clearfix">
          <div class="col-md-12 column">
            <!-- 排行 -->
            <div id="updateDataPanel">
              <div class="numberBlock" id="numberBlock1">
                确诊人数
                <h4>NONE</h4>
                <p>新增</p>
              </div>
              <div class="numberBlock" id="numberBlock2">
                疑似人数
                <h4>NONE</h4>
                <p>新增</p>
              </div>

              <div class="numberBlock" id="numberBlock3">
                治愈人数
                <h4>NONE</h4>
                <p>新增</p>
              </div>

              <div class="numberBlock" id="numberBlock4">
                死亡人数
                <h4>NONE</h4>
                <p>新增</p>
              </div>

            </div>
          </div>
        </div>
        <div class="row clearfix">
          <div class="col-md-12 column">
            <!-- 排行 -->
            <div id="ranklist"></div>
          </div>
        </div>
        <div class="row clearfix">
          <div class="col-md-12 column">
          </div>
        </div>
      </div>
      <div class="col-md-4 column">
        <div class="row clearfix">
          <div class="col-md-12 column">
            <div class="row clearfix">
              <div class="col-md-12 column">
                <!-- 圆饼 -->
                <div id="timePie"></div>
              </div>
            </div>
          </div>
        </div>
        <div class="row clearfix">
          <div class="col-md-12 column">
            <!-- 时间线 -->
            <div id="timeLine"></div>
          </div>
        </div>
        <div class="row clearfix">
          <div class="col-md-12 column">
            <!-- 日历 -->
            <div id="timeCalendar"></div>
          </div>
        </div>
      </div>
    </div>
  </div>





  <script>
    //初始化图表
    var chartMap = echarts.init(document.getElementById('china-map'), 'chalk');
    var chartMapAnimate = echarts.init(document.getElementById('ChinaMapAnimate'), 'chalk');
    var timePie = echarts.init(document.getElementById('timePie'), 'chalk');
    var timeLineChart = echarts.init(document.getElementById('timeLine'), 'chalk')
    var timeCalendar = echarts.init(document.getElementById('timeCalendar'), 'chalk')
    var incri = echarts.init(document.getElementById('incri'), 'chalk')
    var oBack = document.getElementById("back");
    //初始化数据
    var provinces = ['shanghai', 'hebei', 'shanxi', 'neimenggu', 'liaoning', 'jilin', 'heilongjiang', 'jiangsu', 'zhejiang', 'anhui', 'fujian', 'jiangxi', 'shandong', 'henan', 'hubei', 'hunan', 'guangdong', 'guangxi', 'hainan', 'sichuan', 'guizhou', 'yunnan', 'xizang', 'shanxi1', 'gansu', 'qinghai', 'ningxia', 'xinjiang', 'beijing', 'tianjin', 'chongqing', 'xianggang', 'aomen'];

    var provincesText = ['上海', '河北', '山西', '内蒙古', '辽宁', '吉林', '黑龙江', '江苏', '浙江', '安徽', '福建', '江西', '山东', '河南', '湖北', '湖南', '广东', '广西', '海南', '四川', '贵州', '云南', '西藏', '陕西', '甘肃', '青海', '宁夏', '新疆', '北京', '天津', '重庆', '香港', '澳门'];

    //全国的数据
    var data_OverAll_confirmed = []
    var data_city_confirmed = [];//每个市的发病数量
    var provinceFromAjax = new Array()//从ajax获得的省份列表，不变，作为全局变量
    var city = new Array()

    var confirmedCountOfProvince = new Array();//每个省的发病数量
    var curedCountOfProvince = new Array();//每个省的治愈数量
    var deadCoundOfProvince = new Array();//每个省的死亡数量

    var confirmedCountOfCity = new Array();
    var curedCountofCity = new Array();
    var deadCountOfCity = new Array();

    var TimeConfirmedCountOfChina = new Array();
    var TimeCuredCountOfChina = new Array();
    var TimeDeadCountOfChina = new Array();
    var TimeSusCountOfChina = new Array();//疑似人数的时间序列
    var timeSequence = new Array();//这两个时间序列都是全国的
    var timeSequenceForCalendar = new Array()//给日历用的时间序列，格式为Y-M-D

    //全国的增加量
    var suspectedIncr = new Array()
    var confirmedIncr = new Array()
    var curedIncr = new Array()
    var deadIncr = new Array()

    updateTimeHTML = ""

    function day(x) {
      a = parseInt(x)
      date = new Date(a);
      M = (date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1) + '月';
      D = date.getDate() + '日';
      return M + D
    }
    function dayForCalendar(x) {
      a = parseInt(x)
      date = new Date(a);
      Y = date.getFullYear() + '-';
      M = (date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1) + '-';
      D = date.getDate();
      return Y + M + D
    }
    function getALLday(x) {
      var date = new Date(x);
      Y = date.getFullYear() + '-';
      M = (date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1) + '-';
      D = date.getDate() + ' ';
      h = date.getHours() + ':';
      m = date.getMinutes() + ':';
      s = date.getSeconds();
      return (Y + M + D + h + m + s)
    }


    //取得全国省份和对应的数量
    function get_allChina_provinces(data) {
      for (i = 0, j = 0; i < (data.results).length; i++) {
        if (data.results[i].country == "中国") {
          provinceFromAjax[j] = data.results[i].provinceShortName
          confirmedCountOfProvince[j] = data.results[i].confirmedCount
          curedCountOfProvince[j] = data.results[i].curedCount
          deadCoundOfProvince[j] = data.results[i].deadCount
          j++
        }
      }
      console.log(provinceFromAjax)
      console.log(confirmedCountOfProvince)
      //return province
    }


    //取得最新的市的数据
    function get_thisProvince_city_NEW(data) {
      for (i = 0; i < (data.results[0].cities).length; i++) {
        var tmp = {
          name: data.results[0].cities[i].cityName + "市",
          value: data.results[0].cities[i].confirmedCount
        };
        city[i] = data.results[0].cities[i].cityName;
        confirmedCountOfCity[i] = data.results[0].cities[i].confirmedCount
        curedCountofCity[i] = data.results[0].cities[i].curedCount
        deadCountOfCity[i] = data.results[0].cities[i].deadCount
        data_city_confirmed.push(tmp)
      }
      console.log(data_city_confirmed)
    }


    //获取全国的信息
    $.ajax({
      type: "GET", //GET还是POST,不是必须
      url: "https://lab.isaaclin.cn/nCoV/api/area?latest=1",
      success: function (data) {
        get_allChina_provinces(data)
        for (i = 0; i < data.results.length; i++) {
          if (data.results[i].provinceShortName == '湖北') {
            updateTimeHTML = getALLday(data.results[i].updateTime)
            document.getElementById("updateTime").innerHTML = "数据更新时间：" + updateTimeHTML
          }

        }
        for (i = 0; i < provinceFromAjax.length; i++) {
          var tmp = {
            name: provinceFromAjax[i],
            value: confirmedCountOfProvince[i]
          };
          data_OverAll_confirmed.push(tmp);
        }
        console.log(data_OverAll_confirmed)

        oBack.onclick = function () {
          setRanklist(provinceFromAjax, confirmedCountOfProvince, curedCountOfProvince, deadCoundOfProvince)
          initEcharts("china", "中国");
        };

        initEcharts("china", "中国");
        setRanklist(provinceFromAjax, confirmedCountOfProvince, curedCountOfProvince, deadCoundOfProvince)
      }
    });



    //获取全国的时间序列信息
    $.ajax({
      type: "GET", //GET还是POST,不是必须
      url: "https://lab.isaaclin.cn/nCoV/api/overall?latest=0",
      success: function (data) {
      document.getElementById("loadingALL").style.display = 'none'

        //首先更新一下最新的消息
        $("#numberBlock1").find('h4').html(data.results[0].confirmedCount)
        $("#numberBlock2").find('h4').html(data.results[0].suspectedCount)
        $("#numberBlock3").find('h4').html(data.results[0].curedCount)
        $("#numberBlock4").find('h4').html(data.results[0].deadCount)
        $("#numberBlock1").find('p').html("新增 " + data.results[0].confirmedIncr)
        $("#numberBlock2").find('p').html("新增 " + data.results[0].suspectedIncr)
        $("#numberBlock3").find('p').html("新增 " + data.results[0].curedIncr)
        $("#numberBlock4").find('p').html("新增 " + data.results[0].deadIncr)


        //然后获取
        for (i = 0, j = 0; i < (data.results).length; i++) {

          if (timeSequence[j - 1] == day(data.results[i].updateTime)) {

          } else {
            timeSequenceForCalendar[j] = dayForCalendar(data.results[i].updateTime)
            timeSequence[j] = day(data.results[i].updateTime)
            TimeConfirmedCountOfChina[j] = data.results[i].confirmedCount
            TimeCuredCountOfChina[j] = data.results[i].curedCount
            TimeDeadCountOfChina[j] = data.results[i].deadCount
            TimeSusCountOfChina[j] = data.results[i].suspectedCount

            suspectedIncr[j] = data.results[i].suspectedIncr
            deadIncr[j] = data.results[i].deadIncr
            curedIncr[j] = data.results[i].curedIncr
            confirmedIncr[j] = data.results[i].confirmedIncr
            j++

          }
        }

        console.log("以下是全国的时间序列信息")
        console.log(timeSequence)
        console.log(TimeSusCountOfChina)
        settimePie(timeSequence, TimeConfirmedCountOfChina, TimeCuredCountOfChina, TimeDeadCountOfChina, TimeSusCountOfChina)
        settimeLine(timeSequence, TimeConfirmedCountOfChina, TimeCuredCountOfChina, TimeDeadCountOfChina, TimeSusCountOfChina)
        settimeCalendar(timeSequenceForCalendar, TimeConfirmedCountOfChina, TimeCuredCountOfChina, TimeDeadCountOfChina, TimeSusCountOfChina)

        setIncri(timeSequence.slice(10), confirmedIncr, curedIncr, deadIncr, suspectedIncr)

      }
    });



    // 初始化echarts
    function initEcharts(pName, Chinese_, dataArray) {

      var tmpdata_OverAll_confirmed = pName === "china" ? data_OverAll_confirmed : dataArray;
      // console.log("hello!!!已完成地图的初始化")
      // console.log(tmpdata_OverAll_confirmed)
      var option = {

        tooltip: {//信息提示框
          show: true,
          type: 'shadow',
          formatter: '{a} {b0}<br>确诊人数： {c0}<br/>'
        },
        title: {
          text: (Chinese_ || pName) + "确诊患者数据分布",
          left: 'center'
        },
        series: {

          name: Chinese_ || pName,
          type: 'map',
          mapType: pName,
          roam: false,//是否开启鼠标缩放和平移漫游
          itemStyle: {//地图区域的多边形 图形样式
            normal: {//是图形在默认状态下的样式
              label: {
                show: true,//是否显示标签
                textStyle: {
                  color: "pink",
                  fontSize: "20",
                }
              }
            },
            emphasis: {//是图形在高亮状态下的样式,比如在鼠标悬浮或者图例联动高亮时
              label: { show: true }
            },
            normal: {
              //shadowBlur: 50,
              //shadowColor: 'rgba(0, 0, 0, 0.2)',
              borderColor: "blue"
            },
            emphasis: {
              areaColor: "yellow",
              shadowOffsetX: 0,
              shadowOffsetY: 0,
              borderWidth: 3
            }
          },
          data: tmpdata_OverAll_confirmed,
          top: "3%",//组件距离容器的距离
        },
        visualMap: {
          min: 0,
          max: 10000,
          left: 26,
          bottom: 10,
          showLabel: !0,
          textStyle:{
            color:'white'
          },
          text: ["高", "低"],
          pieces: [
            {
              gt: 1000,
              label: "> 1000 人",
              color: "#7f1100"
            },
            {
              gte: 500,
              lte: 999,
              label: "500 - 999 人",
              color: "#ff5428"
            },
            {
              gte: 100,
              lt: 499,
              label: "100 - 499 人",
              color: "#ff8c71"
            },
            {
              gt: 10,
              lt: 99,
              label: "10 - 99 人",
              color: "#ffd768"
            },
            {
              gt: 0,
              lt: 9,
              label: "0 - 9 人",
              color: "#ffffff"
            }
          ],
          show: !0
        }
      };
      chartMap.setOption(option);

      chartMap.off("click");

      if (pName === "china") { // 全国时，添加click 进入省级
        chartMap.on('click', function (param) {
          console.log("现在你点击的是" + param.name);

          chartMap.showLoading(
            {
              text: '正在查询该地区的疫情信息',
              color: '#00fdff',
              textColor: '#000',
              maskColor: 'rgba(0, 0, 0, 0.8)',
              zlevel: 0
            }
          );
          var url
          if (param.name == "西藏" || param.name == "内蒙古") {
            url = "https://lab.isaaclin.cn/nCoV/api/area?latest=0&province=" + param.name + "自治区"
            if (param.name == "西藏") {
              alert("西藏部分地区地理信息缺失\n您仍然可以从其他图表中了解疫情发展情况\n\n您可以访问http://www.xinjiang.gov.cn/新疆维吾尔自治区人民政府来获取最新消息\n若有不适，请尽快联系社区医院。\n\n祝你平安。")
            }
          } else if (param.name == "北京" || param.name == "天津" || param.name == "重庆" || param.name == "上海") {//四个直辖市
            url = "https://lab.isaaclin.cn/nCoV/api/area?latest=0&province=" + param.name + "市"
          } else if (param.name == "广西") {
            url = "https://lab.isaaclin.cn/nCoV/api/area?latest=0&province=广西壮族自治区"
          } else if (param.name == "新疆") {
            url = "https://lab.isaaclin.cn/nCoV/api/area?latest=0&province=新疆维吾尔自治区"
            alert("新疆部分地区地理信息缺失\n您仍然可以从其他图表中了解疫情发展情况\n\n您可以访问http://www.xinjiang.gov.cn/新疆维吾尔自治区人民政府来获取最新消息\n若有不适，请尽快联系社区医院。\n\n祝你平安。")

          } else if (param.name == "宁夏") {
            url = "https://lab.isaaclin.cn/nCoV/api/area?latest=0&province=宁夏回族自治区"
          } else if (param.name == "台湾" || param.name == "澳门" || param.name == "香港") {
            url = "https://lab.isaaclin.cn/nCoV/api/area?latest=0&province=" + param.name
          } else {
            url = "https://lab.isaaclin.cn/nCoV/api/area?latest=0&province=" + param.name + "省"
          }
          //ajax获取该省份的数据
          $.ajax({
            type: "GET",
            url: url,
            //url,"data/dataHenanAllTime.json"
            success: function (data) {
              console.log(data.results[0])
              chartMap.hideLoading();
              data_city_confirmed = []
              get_thisProvince_city_NEW(data)
              //遍历取到provincesText 中的下标  去拿到对应的省js
              for (var i = 0; i < provincesText.length; i++) {
                if (param.name === provincesText[i]) {
                  //显示对应省份的方法
                  setRanklist(city, confirmedCountOfCity, curedCountofCity, deadCountOfCity)
                  showProvince(provinces[i], provincesText[i], data_city_confirmed);

                  break;
                }
              }
            }
          });

        });
      } else { // 省份，添加双击 回退到全国
        chartMap.on("dblclick", function () {
          setRanklist(provinceFromAjax, confirmedCountOfProvince, curedCountOfProvince, deadCoundOfProvince)
          initEcharts("china", "中国");
        });
      }
    }

    // 展示对应的省
    function showProvince(pName, Chinese_, dataArray) {
      console.log("shwo province")
      console.log(dataArray)
      //这写省份的js都是通过在线构建工具生成的，保存在本地，需要时加载使用即可，最好不要一开始全部直接引入。 
      loadBdScript('$' + pName + 'JS', './js/map/province/' + pName + '.js', function () {
        initEcharts(Chinese_, Chinese_, dataArray);
      });
    }

    // 加载对应的JS
    function loadBdScript(scriptId, url, callback) {
      var script = document.createElement("script");
      script.type = "text/javascript";
      if (script.readyState) {  //IE
        script.onreadystatechange = function () {
          if (script.readyState === "loaded" || script.readyState === "complete") {
            script.onreadystatechange = null;
            callback();
          }
        };
      } else {  // Others  
        script.onload = function () {
          callback();
        };
      }
      script.src = url;
      script.id = scriptId;
      document.getElementsByTagName("head")[0].appendChild(script);
    };



    ///////////////////////////////////////////////////////////以下是其他图表

    function setRanklist(provincesList, confirmList, cureList, deadList) {
      var ranklist = echarts.init(document.getElementById('ranklist'), 'chalk');

      ranklistOption = {
        title: {
          text: '',
          subtext: ''
        },
        tooltip: {
          trigger: 'axis',
          axisPointer: {
            type: 'shadow'
          }
        },
        dataZoom: [
          // {
          //   type: 'slider',
          //   show: true,
          //   xAxisIndex: [0],
          //   start: 20,
          //   end: 100
          // },
          {
            type: 'slider',
            show: true,
            yAxisIndex: [0],
            left: '93%',
            start: 50,
            end: 100
          },
          // {
          //   type: 'inside',
          //   xAxisIndex: [0],
          //   start: 20,
          //   end: 100
          // },
          {
            type: 'inside',
            yAxisIndex: [0],
            start: 50,
            end: 100
          }
        ],
        legend: {
          data: ['确诊数', '治愈数', '死亡数']
        },
        grid: {
          left: '3%',
          right: '4%',
          bottom: '3%',
          containLabel: true
        },
        xAxis: {
          type: 'value',
          boundaryGap: [0, 0.01]
        },
        yAxis: {
          type: 'category',
          data: provincesList
        },
        series: [
          {
            name: '确诊数',
            type: 'bar',
            data: confirmList,
            itemStyle: {
              barBorderRadius: 50,
              color: new echarts.graphic.LinearGradient(
                0, 0, 1, 0,
                [
                  { offset: 1, color: '#3C8CE7' },
                  { offset: 0, color: '#2AFADF' }
                ]
              )
            },
          },
          {
            name: '治愈数',
            type: 'line',
            data: cureList
          },
          {
            name: '死亡数',
            type: 'bar',
            data: deadList
          }
        ],
        // animationEasing: 'elasticOut',
        // animationDelayUpdate: function (idx) {
        //   return idx * 10;
        // }
      };
      ranklist.setOption(ranklistOption)
    }

    function settimePie(time, confirmList, cureList, deadList, susList) {
      var options = new Array
      function initThisPie(callback) {
        console.log(time.length)
        for (i = 0; i < time.length; i++) {
          var tmp = {
            title: { text: time[i] + '疫情分布情况' },
            series: {
              data: [
                {
                  name: '确诊率',
                  value: confirmList[i],
                  itemStyle: {
                    color: new echarts.graphic.LinearGradient(
                      0.5, 0, 0, 0.5,
                      [
                        { offset: 1, color: '#0066ff' },
                        { offset: 0, color: '#00ffea' }
                      ]),
                    shadowBlur: 20,
                    shadowColor: '#0066ff',

                  },
                },
                {
                  name: '治愈率', value: cureList[i],
                  itemStyle: {
                    color: new echarts.graphic.LinearGradient(
                      0.5, 0, 0, 0.5,
                      [
                        { offset: 1, color: '#F0FF00' },
                        { offset: 0, color: '#58CFFB' }
                      ]),
                    shadowBlur: 20,
                    shadowColor: '#F0FF00',

                  }
                },
                {
                  name: '死亡率', value: deadList[i],
                  itemStyle: {
                    color: new echarts.graphic.LinearGradient(
                      0.5, 0, 0, 0.5,
                      [
                        { offset: 1, color: 'black' },
                        { offset: 0, color: 'gray' }
                      ]),
                    shadowBlur: 20,
                    shadowColor: 'gray',

                  }
                },
                {
                  name: '疑似率',
                  value: susList[i],
                  itemStyle: {
                    color: new echarts.graphic.LinearGradient(
                      0.5, 0, 0, 0.5,
                      [
                        { offset: 1, color: '#FA742B' },
                        { offset: 0, color: '#FCFF00' }
                      ]),
                    shadowBlur: 20,
                    shadowColor: '#FA742B',

                  },
                },
              ]
            }
          }
          options.push(tmp)
        }
        callback()
      }

      initThisPie(function () {
        console.log(options)
        console.log("产生了回调")
        timePie.setOption(
          {

            baseOption: {
              // backgroundColor: new echarts.graphic.RadialGradient(0.3, 0.3, 0.8, [{
              //   offset: 0,
              //   color: '#f7f8fa'
              // }, {
              //   offset: 1,
              //   color: '#cdd0d5'
              // }]),
              timeline: {
                data: time,
                axisType: 'category',
                autoPlay: true,
                rewind: true,
                playInterval: 500,
                controlPosition: 'right',
                tooltip: {
                  trigger: 'item',
                  formatter: '显示{b}的疫情数据'
                },
              },
              legend: {
                show: true,
                left: 0,
                top: 40,
                orient: 'vertical'
              },
              title: {
                subtext: ''
              },
              grid: {},
              tooltip: {
                trigger: 'item',
                formatter: '{a} <br/>{b} : {c} ({d}%)'
              },

              series: [
                {
                  selectedMode: 'single',
                  selectedOffset: 30,
                  clockwise: true,
                  name: '新型冠状病毒',
                  type: 'pie',
                  radius: '55%',
                  center: ['50%', '50%'],
                  // roseType: 'area',

                  label: {
                    color: 'white',
                    position: 'outer',
                    alignTo: 'none',
                    bleedMargin: 5
                  },
                  labelLine: {
                    lineStyle: {
                      color: 'white'
                    },
                    smooth: 0.2,
                    length: 10,
                    length2: 20
                  },
                  itemStyle: [
                    // {
                    //   color: 'black',
                    //   shadowBlur: 200,
                    //   shadowColor: 'rgba(0, 0, 0, 0.5)'
                    // },{
                    //   color: '#908CB8',
                    //   shadowBlur: 200,
                    //   shadowColor: 'rgba(0, 0, 0, 0.5)'
                    // },{
                    //   color: '#FFC051',
                    //   shadowBlur: 200,
                    //   shadowColor: 'rgba(0, 0, 0, 0.5)'
                    // }
                  ],

                  animationType: 'scale',
                  animationEasing: 'elasticOut',
                  animationDelay: function (idx) {
                    return Math.random() * 200;
                  }
                }
              ]
            },
            options: options
          }
        );

      })

    }


    function settimeLine(time, confirmList, cureList, deadList, susList) {

      time = time.reverse()
      confirmList = confirmList.reverse()
      deadList = deadList.reverse()
      susList = susList.reverse()
      cureList = cureList.reverse()
      timeLineChart.setOption(
        {
          title: {
            text: '疫情增长情况'
          },
          tooltip: {
            trigger: 'axis'
          },
          legend: {
            data: ['确诊数', '治愈数', '死亡数', '疑似数']
          },
          dataZoom: [
            {
              type: 'slider',
              show: true,
              xAxisIndex: [0],
              start: 20,
              end: 100
            },
            {
              type: 'slider',
              show: true,
              yAxisIndex: [0],
              left: '93%',
              start: 0,
              end: 60
            },
            {
              type: 'inside',
              xAxisIndex: [0],
              start: 20,
              end: 100
            },
            {
              type: 'inside',
              yAxisIndex: [0],
              start: 0,
              end: 60
            }
          ],
          grid: {
            left: '3%',
            right: '4%',
            bottom: '3%',
            containLabel: true
          },
          toolbox: {
            feature: {
              saveAsImage: {}
            }
          },
          xAxis: {
            type: 'category',
            boundaryGap: false,
            data: time
          },
          yAxis: {
            type: 'value'
          },
          series: [
            {
              name: '确诊数',
              type: 'line',
              data: confirmList
            },
            {
              name: '治愈数',
              type: 'line',
              data: cureList
            },
            {
              name: '死亡数',
              type: 'line',
              data: deadList
            },
            {
              name: '疑似数',
              type: 'line',
              stack: '总量',
              data: susList,
              //       itemStyle: {
              //     barBorderRadius: 5,
              //     color: new echarts.graphic.LinearGradient(
              //         0, 0, 0, 1,
              //         [
              //             {offset: 0, color: '#14c8d4'},
              //             {offset: 1, color: '#43eec6'}
              //         ]
              //     )
              // },
            },
          ]
        }

      );


    }
    function settimeCalendar(time, confirmList, cureList, deadList, susList) {

      var thisdataConfirmed = new Array()
      var thisdataSus = new Array()
      var thisdatacure = new Array()
      var thisdatadead = new Array()
      var thisdataCureRatio = new Array()

      function initCalendar(callback) {

        calendarRange = [time[0], time[time.length - 1]]
        for (i = 0; i < time.length; i++) {
          thisdataConfirmed[i] = [time[i], confirmList[time.length - i - 1]]
          thisdatacure[i] = [time[i], cureList[time.length - i - 1]]
          thisdataSus[i] = [time[i], susList[time.length - i - 1]]
          thisdatadead[i] = [time[i], deadList[time.length - i - 1]]
          thisdataCureRatio[i] = [time[i], (deadList[time.length - i - 1] / cureList[time.length - i - 1])]
        }

        callback()
      }

      initCalendar(function () {
        console.log(thisdatadead)
        console.log(thisdatacure)
        console.log(thisdataCureRatio)
        thisdataCureRatio.reverse()
        timeCalendar.setOption(
          {
            title: [{
              top: 30,
              left: 50,
              text: '2020年疫情确诊数月份热力图',
              seriesIndex: 1,

            }, {
              top: 30,
              left: 380,
              text: '死亡数-治愈数之比率',
              seriesIndex: 1,
            }],
            tooltip: {},
            visualMap: [
              {
                min: 0,
                max: 50000,
                calculable: true,
                seriesIndex: 0,
                orient: 'horizontal',
                right: '55%',
                bottom: 14,
                inRange: {
                  color: ['#FFC600', '#E80505']
                }
              },
              {
                min: 0,
                max: 1.5,
                calculable: true,
                seriesIndex: 1,
                orient: 'horizontal',
                left: '55%',
                bottom: 14,
                inRange: {
                  color: ['#92FFC0', '#002661']
                }
              },
            ],
            calendar: [{
              title: "fabi",
              orient: 'vertical',
              top: 120,
              left: 70,
              right: 300,
              cellSize: '30',
              range: calendarRange,
              itemStyle: {
                borderWidth: 0.5
              },
              yearLabel: {
                show: false,
                margin: 40
              },
              dayLabel: {
                color: '#cecece',
                firstDay: 1,
                nameMap: ['周日', '周一', '周二', '周三', '周四', '周五', '周六']
              },
              monthLabel: {
                color: '#cecece',
                nameMap: 'cn',
                margin: 20
              },
            }, {
              orient: 'vertical',
              top: 120,
              left: 370,
              right: 20,
              cellSize: '30',
              range: calendarRange,
              itemStyle: {
                borderWidth: 0.5
              },
              yearLabel: {
                show: false,
                margin: 40
              },
              dayLabel: {
                color: '#cecece',
                firstDay: 1,
                nameMap: ['周日', '周一', '周二', '周三', '周四', '周五', '周六']
              },
              monthLabel: {
                color: '#cecece',
                nameMap: 'cn',
                margin: 20
              },
            }
            ],
            series: [{

              name: '确诊数',
              type: 'heatmap',
              calendarIndex: 0,
              coordinateSystem: 'calendar',
              data: thisdataConfirmed
            }
              , {
              name: '死亡数与治愈数之比',
              type: 'heatmap',
              calendarIndex: 1,
              coordinateSystem: 'calendar',
              data: thisdataCureRatio
            },
              // {
              //   name: '治愈数',
              //   type: 'heatmap',
              //   coordinateSystem: 'calendar',
              //   data: thisdatacure
              // }, {
              //   name: '死亡数',
              //   type: 'heatmap',
              //   coordinateSystem: 'calendar',
              //   data: thisdatadead
              // }
            ]
          }

        );
      })





    }

    function setIncri(time, confirmList, cureList, deadList, susList) {

      incri.setOption(
        {
          title: {
            text: '全国疫情增长情况'
          },
          toolbox: {
            // y: 'bottom',
            feature: {
              magicType: {
                type: ['stack', 'tiled']
              },
              dataView: {},
              saveAsImage: {
                pixelRatio: 2
              }
            }
          },
          tooltip: {
            show: true
          },
          legend: {
            show: true,
            bottom: 0
          },
          xAxis: {
            data: time,
            splitLine: {
              show: false
            }
          },
          yAxis: {
          },
          series: [{
            name: '确诊人数增长量',
            type: 'bar',
            data: confirmList.reverse().slice(10),
            animationDelay: function (idx) {
              return idx * 10;
            },
            itemStyle: {
              barBorderRadius: 50,
              color: new echarts.graphic.LinearGradient(
                0, 0, 0, 1,
                [
                  { offset: 1, color: '#F05F57' },
                  { offset: 0, color: 'red' }
                ]
              )
            },
          }, {
            name: '疑似人数增长量',
            type: 'bar',
            data: susList.reverse().slice(10),
            animationDelay: function (idx) {
              return idx * 10 + 100;
            },
            itemStyle: {
              barBorderRadius: 50,
              color: new echarts.graphic.LinearGradient(
                0, 0, 0, 1,
                [
                  { offset: 1, color: '#FCCF31' },
                  { offset: 0, color: '#F55555' }
                ]
              )
            },

          }, {
            name: '治愈人数增长量',
            type: 'bar',
            data: curedIncr.reverse().slice(10),
            animationDelay: function (idx) {
              return idx * 10 + 200;
            },
            itemStyle: {
              barBorderRadius: 50,
              color: new echarts.graphic.LinearGradient(
                0, 0, 0, 1,
                [
                  { offset: 0, color: '#14c8d4' },
                  { offset: 1, color: '#43eec6' }
                ]
              )
            },
          }, {
            name: '死亡人数增长量',
            type: 'bar',
            data: deadIncr.reverse().slice(10),
            animationDelay: function (idx) {
              return idx * 10 + 300;
            },
            itemStyle: {
              barBorderRadius: 50,
              color: new echarts.graphic.LinearGradient(
                0, 0, 0, 1,
                [
                  { offset: 1, color: 'blue' },
                  { offset: 0, color: 'black' }
                ]
              )
            },
          }],
          animationEasing: 'elasticOut',
          animationDelayUpdate: function (idx) {
            return idx * 100;
          }
        }

      );


    }

    function setChinaAnimate() {
      // // var option = []
      // var options = []

      var days = ['01-20', '01-21', '01-22', '01-23', '01-24', '01-25', '01-26', '01-27', '01-28', '01-29', '01-30', '02-13'];

      var province = ['湖北', '广东', '浙江', '湖南', '河南', '安徽', '重庆', '山东', '江西', '四川', '江苏', '北京', '福建', '上海', '广西', '河北', '陕西', '云南', '海南', '黑龙江', '辽宁', '山西', '天津', '甘肃', '内蒙古', '新疆', '宁夏', '吉林', '贵州', '青海', '西藏', '澳门', '香港', '台湾'];

      var data = [
        [270, 14, 0, 0, 0, 0, 0, 0, 0, 0, 0, 5, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [375, 26, 5, 1, 1, 0, 5, 1, 2, 2, 0, 10, 0, 9, 0, 0, 0, 1, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [444, 32, 10, 9, 5, 4, 9, 6, 3, 8, 1, 14, 1, 16, 2, 1, 0, 1, 4, 2, 2, 1, 3, 0, 0, 0, 0, 1, 3, 0, 0, 0, 0, 0],
        [549, 53, 43, 24, 9, 15, 27, 9, 7, 15, 9, 26, 5, 20, 13, 2, 3, 2, 8, 4, 4, 1, 5, 2, 1, 2, 2, 3, 3, 0, 0, 1, 2, 0],
        [729, 78, 62, 43, 32, 39, 57, 21, 18, 28, 18, 36, 10, 33, 23, 8, 5, 5, 8, 9, 12, 6, 8, 4, 2, 3, 3, 4, 4, 0, 0, 2, 4, 2],
        [1052, 98, 104, 69, 83, 60, 75, 39, 36, 44, 31, 51, 18, 40, 33, 13, 15, 11, 19, 15, 17, 9, 10, 7, 7, 4, 4, 4, 5, 1, 0, 3, 5, 4],
        [1423, 146, 128, 100, 128, 70, 110, 63, 48, 69, 47, 68, 29, 53, 46, 18, 22, 16, 22, 21, 22, 13, 14, 14, 11, 5, 7, 6, 7, 4, 0, 4, 6, 6],
        [2714, 188, 173, 143, 168, 106, 132, 87, 72, 90, 70, 80, 59, 66, 51, 33, 35, 26, 33, 30, 27, 20, 23, 19, 13, 10, 10, 8, 9, 6, 0, 6, 8, 7],
        [3354, 241, 296, 221, 206, 152, 147, 121, 109, 108, 99, 91, 82, 80, 58, 48, 46, 51, 43, 37, 36, 27, 24, 24, 16, 13, 12, 9, 9, 6, 0, 6, 10, 8],
        [4586, 272, 296, 221, 206, 152, 165, 130, 162, 108, 99, 111, 84, 96, 58, 48, 56, 55, 43, 38, 39, 35, 27, 24, 16, 13, 12, 9, 9, 6, 1, 7, 10, 8],
        [5806, 354, 428, 277, 278, 200, 206, 158, 162, 142, 129, 121, 101, 128, 87, 65, 66, 76, 46, 44, 45, 39, 31, 29, 18, 14, 17, 14, 12, 8, 1, 7, 12, 9],
        [48206, 1241, 1145, 968, 1169, 910, 525, 509, 872, 451, 570, 366, 279, 315, 222, 265, 229, 156, 157, 395, 116, 126, 117, 87, 61, 63, 64, 84, 135, 18, 1, 10, 51, 18],

      ];



      // for(i=0;i<provinces.length;i++){
      //   for(j=0;j<days.length;j++){
      //     var yes=0
      //     for(x=0;x<AjaxData.results.length;x++){
      //       if(AjaxData.results[x].provinceShortName==provinces[i]){
      //         data[j][i] = AjaxData.results[x].confirmedCount
      //       }
      //     }



      //   }
      // }

      var option = {
        baseOption: {

          timeline: {
            axisType: 'category',
            // realtime: false,
            // loop: false,
            autoPlay: true,
            playInterval: 2000,
            symbolSize: 12,
            left: '5%',
            right: '5%',
            bottom: '0%',
            width: '90%',
            // controlStyle: {
            //     position: 'left'
            // },
            data: days,
            tooltip: {
              formatter: days
            },
          },

          tooltip: {
            show: true,
            formatter: function (params) {
              return params.name + '：' + params.data['value']
            },
          },
          visualMap: {
            type: 'piecewise',
            pieces: [{
              min: 1001,
              color: '#00038c'
            },
            {
              min: 501,
              max: 1000,
              color: '#001efd'
            },
            {
              min: 251,
              max: 500,
              color: '#0053f9'
            },
            {
              min: 101,
              max: 250,
              color: '#0081f5'
            },
            {
              min: 11,
              max: 100,
              color: '#00b8f0'
            },
            {
              min: 1,
              max: 10,
              color: '#c3f1ff'
            },
            {
              value: 0,
              color: 'rgba(255, 255,255, 0)'
            }
            ],
            orient: 'vertical',
            itemWidth: 25,
            itemHeight: 15,
            showLabel: true,
            seriesIndex: [0],

            textStyle: {
              color: '#7B93A7'
            },
            bottom: '10%',
            left: "5%",
          },
          grid: {
            right: '5%',
            top: '20%',
            bottom: '10%',
            width: '20%'
          },
          xAxis: {
            min: 0,
            max: 4000,
            show: false
          },
          yAxis: [{
            inverse: true,
            offset: '2',
            type: 'category',
            data: '',
            nameTextStyle: {
              color: '#fff'
            },
            axisTick: {
              show: false,
            },
            axisLabel: {
              //rotate:45,
              textStyle: {
                fontSize: 14,
                color: 'white',
              },
              interval: 0
            },
            axisLine: {
              show: false,
              lineStyle: {
                color: 'white'
              },
            },
            splitLine: {
              show: false,
              lineStyle: {
                color: 'white'
              }
            },
          }],
          geo: {
            map: 'china',
            right: '35%',
            left: '5%',
            label: {
              emphasis: {
                show: false,
              }
            },

            itemStyle: {
              normal: {
                //shadowBlur: 50,
                shadowColor: 'rgba(128, 217, 248, 1)',
                shadowOffsetX: -2,
                shadowOffsetY: 2,
                shadowBlur: 5,
                borderColor: 'rgba(147, 235, 248, 1)',
              },
              emphasis: {
                borderColor: new echarts.graphic.LinearGradient(
                  0, 0, 0, 1,
                  [
                    { offset: 1, color: '#0066ff' },
                    { offset: 0, color: '#00ffea' }
                  ]),
                borderWidth: 3,
                areaColor:
                  new echarts.graphic.LinearGradient(
                    0, 0, 0, 1,
                    [
                      { offset: 0, color: '#0066ff' },
                      { offset: 1, color: '#00ffea' }
                    ]
                  )

              }
            }
          },
          series: [{
            name: 'mapSer',
            type: 'map',
            map: 'china',
            roam: false,
            geoIndex: 0,
            label: {
              show: false,
            },
          },
          {
            name: '',
            type: 'bar',
            zlevel: 2,
            barWidth: '40%',
            label: {
              normal: {
                show: true,
                fontSize: 14,
                position: 'right',
                formatter: '{c}'
              }
            },
          }
          ],

        },
        animationDurationUpdate: 3000,
        animationEasingUpdate: 'quinticInOut',
        options: []
      }

      for (var n = 0; n < days.length; n++) {

        var res = [];
        for (j = 0; j < data[n].length; j++) {
          res.push({
            name: province[j],
            value: data[n][j]
          });
        }
        res.sort(function (a, b) {
          return b.value - a.value;
        }).slice(0, 6);

        res.sort(function (a, b) {
          return a.value - b.value;
        });
        var res1 = [];
        var res2 = [];
        for (t = 0; t < 10; t++) {
          res1[t] = res[res.length - 1 - t].name;
          res2[t] = res[res.length - 1 - t].value;
        }
        // console.log(res1);
        // console.log("----------------");
        // console.log(province);
        option.options.push({
          title: [{
            text: days[n] + ' 新型冠状病毒全国感染人数',
            textStyle: {
              color: 'white',
              fontSize: 28
            },
            left: 20,
            top: 20,
          },
          {
            show: true,
            text: '感染人数前十的省份',
            textStyle: {
              color: 'white',
              fontSize: 18
            },
            right: '10%',
            top: '15%'
          }
          ],
          yAxis: {
            data: res1,
          },
          series: [{
            type: 'map',
            data: res
          }, {
            type: 'bar',
            data: res2,
            itemStyle: {
              normal: {
                color: function (params) {
                  // build a color map as your need.
                  var colorList = [{
                    colorStops: [{
                      offset: 0,
                      color: '#FF0000' // 0% 处的颜色
                    }, {
                      offset: 1,
                      color: '#990000' // 100% 处的颜色
                    }]
                  },
                  {
                    colorStops: [{
                      offset: 0,
                      color: '#00C0FA' // 0% 处的颜色
                    }, {
                      offset: 1,
                      color: '#2F95FA' // 100% 处的颜色
                    }]
                  }
                  ];
                  if (params.dataIndex < 3) {
                    return colorList[0]
                  } else {
                    return colorList[1]
                  }
                },
              }
            },
          }]
        });
      }

      chartMapAnimate.setOption(option)
    }

    setChinaAnimate()



    $("#change1").click(function () {
      document.getElementById("back").style.display = 'none'
      document.getElementById("china-map").style.display = 'none'
      document.getElementById("ChinaMapAnimate").style.display = 'block'
      document.getElementById("change1").style.backgroundColor = 'rgb(0, 161, 224)'
      document.getElementById("change2").style.backgroundColor = 'rgb(116, 116, 116)'
    })
    $("#change2").click(function () {
      document.getElementById("back").style.display = 'block'
      document.getElementById("china-map").style.display = 'block'
      document.getElementById("ChinaMapAnimate").style.display = 'none'
      document.getElementById("change2").style.backgroundColor = 'rgb(0, 161, 224)'
      document.getElementById("change1").style.backgroundColor = 'rgb(116, 116, 116)'
    })
    $("#OutShow").click(function () {
      document.getElementById("show").style.display = 'none'
    })
    $("#author").click(function () {
      document.getElementById("show").style.display = 'block'
    })
    $("#news").click(function () {
      alert("SORRY...\nThis module has been shut down, thanks for ur attention.\nlove,zc")
    })

  </script>
</body>

</html>